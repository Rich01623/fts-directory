<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTS Directory</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        :root {
            --fts-red: #E62411;
            --outlook-blue: #0078d4;
            --maps-green: #28a745;
        }

        body { 
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; font-family: -apple-system, system-ui, sans-serif; 
            background-color: #f4f7f9; padding-top: 30px; 
        }

        /* LOGO STYLING */
        .logo-container {
            width: 92%;
            max-width: 300px;
            margin-bottom: 25px;
            text-align: center;
        }
        .logo-container img {
            max-width: 100%;
            height: auto;
            max-height: 120px; /* Adjust this to make your logo bigger/smaller */
        }

        .search-container { width: 92%; max-width: 500px; text-align: center; position: relative; }

        .input-wrapper { position: relative; width: 100%; }
        input { 
            width: 100%; padding: 16px 50px 16px 25px; font-size: 1.1rem; border: none; 
            border-radius: 15px; outline: none; box-sizing: border-box; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); -webkit-appearance: none;
        }

        #clearBtn {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            background: #ccc; color: white; border: none; border-radius: 50%;
            width: 24px; height: 24px; font-weight: bold; cursor: pointer; display: none;
        }

        #status { margin-top: 15px; color: #666; font-style: italic; font-size: 0.85rem; }
        
        #emailAllBtn {
            display: none; margin-top: 15px; padding: 12px 24px; 
            background-color: var(--outlook-blue); color: white; border: none; 
            border-radius: 10px; font-weight: 600; cursor: pointer; width: 100%;
        }

        #results { margin-top: 20px; width: 100%; }

        .result-item { 
            background: white; margin-bottom: 12px; padding: 20px; 
            border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            line-height: 1.8; color: #333; font-size: 1.05rem;
            border-left: 5px solid var(--fts-red);
        }

        .result-item a { text-decoration: none; display: inline-block; margin: 2px 0; }
    </style>
</head>
<body>

    <div class="logo-container">
        <img src="logo.png" alt="FTS Logo">
    </div>

    <div class="search-container">
        <div class="input-wrapper">
            <input type="text" id="searchInput" placeholder="Search names, depts, postcodes..." autofocus>
            <button id="clearBtn">‚úï</button>
        </div>
        <div id="status">Connecting...</div>
        <button id="emailAllBtn">üìß Email All Results</button>
        <div id="results"></div>
    </div>

    <script>
        const SHEET_ID = '1WDctuQ1oragZhv6GfBCl56Wk6czlmtKD-KFDR6Bv0_g';
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=responseHandler:handleResponse`;

        const input = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearBtn');
        const resultsDiv = document.getElementById('results');
        const statusDiv = document.getElementById('status');
        const emailAllBtn = document.getElementById('emailAllBtn');

        let allData = [];
        let currentEmails = [];

        function loadData() {
            const script = document.createElement('script');
            script.src = url;
            document.body.appendChild(script);
        }

        window.handleResponse = function(response) {
            if (response && response.table && response.table.rows) {
                allData = response.table.rows;
                statusDiv.innerHTML = "Database Ready.";
            } else {
                statusDiv.innerHTML = "Connection error.";
            }
        };

        clearBtn.addEventListener('click', () => {
            input.value = '';
            input.dispatchEvent(new Event('input'));
            input.focus();
        });

        input.addEventListener('input', function() {
            const query = input.value.trim().toLowerCase();
            resultsDiv.innerHTML = "";
            currentEmails = [];
            emailAllBtn.style.display = "none";
            clearBtn.style.display = query.length > 0 ? "block" : "none";

            if (query.length < 2) {
                statusDiv.innerHTML = "Enter 2+ characters...";
                return;
            }

            let foundCount = 0;
            let html = '';

            allData.forEach(row => {
                const rowValues = row.c.map(cell => {
                    if (!cell || cell.v === null || cell.v === undefined) return "";
                    return cell.f ? cell.f.toString() : cell.v.toString();
                });

                const rowString = rowValues.join(" ").toLowerCase();

                if (rowString.includes(query)) {
                    foundCount++;
                    
                    const displayData = rowValues.filter(v => v.trim() !== "").map(item => {
                        const cleanItem = item.trim();
                        
                        if (cleanItem.includes('@') && cleanItem.includes('.')) {
                            currentEmails.push(cleanItem);
                            return `<a href="mailto:${cleanItem}" style="color: var(--outlook-blue); font-weight: bold;">‚úâÔ∏è ${cleanItem}</a>`;
                        }
                        
                        const postcodePattern = /^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i;
                        if (postcodePattern.test(cleanItem)) {
                            return `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(cleanItem)}" target="_blank" style="color: var(--maps-green); font-weight: bold;">üìç ${cleanItem}</a>`;
                        }
                        
                        const isPhone = /^[0-9\s\-\+\(\)]{7,20}$/.test(cleanItem);
                        if (isPhone) {
                            return `<a href="tel:${cleanItem.replace(/\s/g, '')}" style="color: var(--fts-red); font-weight: bold;">üìû ${cleanItem}</a>`;
                        }

                        return `<span>${cleanItem}</span>`;
                    }).join('<br>');

                    html += `<div class="result-item">${displayData}</div>`;
                }
            });

            if (foundCount > 0) {
                statusDiv.innerHTML = `Found ${foundCount} result(s)`;
                resultsDiv.innerHTML = html;
                if (currentEmails.length > 1) {
                    emailAllBtn.style.display = "block";
                    emailAllBtn.innerText = `üìß Email All (${currentEmails.length})`;
                }
            } else {
                statusDiv.innerHTML = "No matches found.";
            }
        });

        loadData();
    </script>
</body>
</html>
